// Generated by CoffeeScript 1.8.0
(function() {
  var services;

  services = angular.module('myApp.services', []);


  services.factory('user', function($http, $cookies, $q) {
    return {
      login: function(login, password) {
        var deferred;
        deferred = $q.defer();
        $http.post('/api/login', {
          username: login,
          password: password
        }).success(function(data) {
          var options;
          $cookies.token = data;
          options = {
            headers: {
              "X-CH-Token": $cookies.token
            }
          };
          console.dir(data);
          return $http.get("/api/v1/whoami", {
            headers: {
              'X-CH-Token': data
            }
          }).success(function(data) {
            console.dir(data);
            $cookies.user = angular.toJson(data);
            return deferred.resolve(data);
          });
        }).error(function(data) {
          return deferred.reject(data.error);
        });
        return deferred.promise;
      },
      whoami: function() {
        return $http.get("/api/v1/whoami", options).success(function(data) {
          console.dir(data);
          $cookies.user = angular.toJson(data);
          return deferred.resolve(data);
        });
      },
      logout: function() {
        var deferred;
        deferred = $q.defer();
        $http.get('/api/v1/logout', {
          headers: {
            'X-CH-Token': $cookies.token
          }
        }).success(function() {
          delete $cookies.token;
          delete $cookies.user;
          return deferred.resolve();
        }).error(function(data) {
          return deferred.reject(data.error);
        });
        return deferred.promise;
      },
      deleteUserInfo: function() {
        delete $cookies.token;
        return delete $cookies.user;
      },
      get: function() {
        return angular.fromJson($cookies.user);
      },
      getToken: function() {
        return $cookies.token;
      }
    };
  });

}).call(this);

